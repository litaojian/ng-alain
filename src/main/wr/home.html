<style>
    .link {
        padding: 0 4px;
    }
</style>
<div class="content__title">
    <h1>个人任务<small>每个人的任务看板</small></h1>
</div>

<nz-card [nzBordered]="false">
    <ng-template #body>
        <form id="queryForm" zx-formInput [formData]="queryForm" nz-form #f="ngForm" (ngSubmit)="onQueryFormSubmit(f)" [nzLayout]="'inline'">
            <input type="hidden" value="queryWorkLoadByOrgId" name="filter" />
            <input type="hidden" value="20" name="pageSize" />
            <div nz-row [nzGutter]="24">
                <div nz-col [nzSpan]="6" class="mb-md">
                    <div nz-form-item class="d-flex">
                        <div nz-form-label><label for="beginDate">开始日期</label></div>
                        <div nz-form-control class="flex-1">
                            <nz-datepicker name="beginDate" [(ngModel)]="queryForm['beginDate']" data-value="${beginOfWeek}$" id="beginDate" [nzSize]="'large'" [nzPlaceHolder]="'开始日期'" class="d-block"></nz-datepicker>
                        </div>
                    </div>
                </div>
                <div nz-col [nzSpan]="6" class="mb-md">
                    <div nz-form-item class="d-flex">
                        <div nz-form-label><label for="endDate">结束日期</label></div>
                        <div nz-form-control class="flex-1">
                            <nz-datepicker name="endDate" [(ngModel)]="queryForm['endDate']" data-value="${endOfWeek}$" id="endDate" [nzSize]="'large'" [nzPlaceHolder]="'结束日期'" class="d-block"></nz-datepicker>
                        </div>
                    </div>
                </div>
                <div nz-col [nzSpan]="expandForm ? 24 : 8" class="mb-md" [class.text-right]="expandForm">
                    <a class="link" href="javascript:void(0);" onclick="changeDate(event,-1);">上周</a>|<a class="link" href="javascript:void(0);" onclick="changeDate(event,1)">下周</a>
                    <button nz-button type="submit" [nzType]="'primary'" [nzLoading]="loading" [nzSize]="'large'" id="queryBtn">查询</button>
                    <button nz-button type="reset" [nzSize]="'large'" class="mx-sm">重置</button>
                    <a (click)="expandForm=!expandForm">
	                    {{expandForm ? '收起' : '展开'}}
	                    <i class="anticon" [class.anticon-down]="!expandForm" [class.anticon-up]="expandForm"></i>
	                </a>
                </div>
            </div>
        </form>
        <div class="mb-md">
        </div>
        <nz-table #nzTable class="fixedLayout" [nzAjaxData]="tableData" nzShowTotal="true" [nzTotal]="totalCount" [nzPageIndex]="pageIndex" [nzPageSize]="pageSize" [nzLoading]="loading" (nzPageIndexChange)="onPageLinkClick($event)" [nzBordered]="true">
            <thead nz-thead>
                <tr>
                    <th rowspan="2" nz-th class="wd50" [nzCheckbox]="true">
                        <label nz-checkbox [(ngModel)]="allChecked" [nzIndeterminate]="indeterminate" (ngModelChange)="checkAll($event)"></label>
                    </th>
                    <th rowspan="2" nz-th class="wd50"><span>编号</span></th>
                    <th rowspan="2" nz-th class="wd60"><span>负责人</span></th>
                    <th colspan="3" nz-th class="wd150"><span>当前未完成</span></th>
                    <th rowspan="2" nz-th class="wd60 center"><span>预估<br>工作量</span></th>
                    <th colspan="7" nz-th class="wd350"><span>工时(小时)</span></th>
                    <th rowspan="2" nz-th class="wd60"><span>实际<br>工作量</span></th>
                    <th colspan="3" nz-th class="wd150"><span>本周完成</span></th>
                    <th rowspan="2" nz-th class="wd20pc center"><span>操作</span></th>
                </tr>
                <tr>
                    <th class="wd60" nz-th><span>需求</span></th>
                    <th class="wd60" nz-th><span>缺陷</span></th>
                    <th class="wd60" nz-th><span>任务</span></th>
                    <th class="wd50 center" nz-th><span>一</span></th>
                    <th class="wd50 center" nz-th><span>二</span></th>
                    <th class="wd50 center" nz-th><span>三</span></th>
                    <th class="wd50 center" nz-th><span>四</span></th>
                    <th class="wd50 center" nz-th><span>五</span></th>
                    <th class="wd50 center" nz-th><span>六</span></th>
                    <th class="wd50 center" nz-th><span>七</span></th>
                    <th class="wd60 center" nz-th><span>需求</span></th>
                    <th class="wd60 center" nz-th><span>BUG</span></th>
                    <th class="wd60 center" nz-th><span>任务</span></th>
                </tr>
            </thead>
            <tbody nz-tbody>
                <tr nz-tbody-tr *ngFor="let row of nzTable.data">
                    <td nz-td [nzCheckbox]="true">
                        <label nz-checkbox [nzDisabled]="row.disabled" [(ngModel)]="row.checked" (ngModelChange)="refreshStatus($event)">
                    </label>
                    </td>
                    <td nz-td>{{row.index}}</td>
                    <td nz-td>{{row.username}}</td>
                    <td nz-td class="text-center">
                        <span *ngIf="row.opened_stories"> <a href="javascript:;" (click)="showModalDialog('/wr/story/list',{'dialogWidth':1000, 'user':row.account, 'beginDate':queryForm['beginDate'],  'endDate':queryForm['endDate' ] ,'status' :'opened'});" link="['../../story/list']"  queryParams="{'user':row.account, 'beginDate':queryForm['beginDate'],  'endDate':queryForm['endDate' ] ,'status' :'opened'}">{{row.opened_stories}}</a></span>
                    </td>
                    <td nz-td class="text-center">
                        <span *ngIf="row.total_bugs"> <a href="javascript:;" (click)="showModalDialog('/wr/bug/list',{'dialogWidth':1000,'user':row.account, 'projectList':row.projectlist, 'beginDate':queryForm['beginDate'],  'endDate':queryForm['endDate'], 'status' :'opened'});" link="['../../bug/list' ]" queryParams="{'user':row.account, 'projectList':row.projectlist, 'beginDate':queryForm['beginDate'],  'endDate':queryForm['endDate'], 'status' :'opened'}">{{row.opened_bugs}}</a></span>
                    </td>
                    <td nz-td class="text-center">
                        <span *ngIf="row.total_tasks"> <a href="javascript:;"  (click)="showModalDialog('/wr/task/list',{'user':row.account, 'beginDate':queryForm['beginDate'], 'endDate':queryForm['endDate'], 'status' :'opened'})" link1="['../../task/list' ]"  queryParams1="{'user':row.account, 'beginDate':queryForm['beginDate'],  'endDate':queryForm['endDate'], 'status' :'opened'}"> {{row.opened_tasks}}</a></span>
                    </td>
                    <td nz-td class="text-center">
                        {{row.total_estimate}}
                    </td>
                    <td nz-td class="text-center">
                        {{row.workhours_1 | number:'1.1-1'}}
                    </td>
                    <td nz-td class="text-center">
                        {{row.workhours_2 | number:'1.1-1'}}
                    </td>
                    <td nz-td class="text-center">
                        {{row.workhours_3 | number:'1.1-1'}}
                    </td>
                    <td nz-td>
                        {{row.workhours_4 | number:'1.1-1'}}
                    </td>
                    <td nz-td>
                        {{row.workhours_5 | number:'1.1-1'}}
                    </td>
                    <td nz-td>
                        {{row.workhours_6 | number:'1.1-1'}}
                    </td>
                    <td nz-td>
                        {{row.workhours_7 | number:'1.1-1'}}
                    </td>
                    <td nz-td class="right">
                        <a href="javascript:;" (click)="showModalDialog('/wr/effort/list',{'user':row.account, 'beginDate':queryForm['beginDate'],  'endDate':queryForm['endDate'] })"> {{row.total_workhours | number:'1.1-1'}}</a>
                    </td>
                    <td nz-td class="left"> <span>&nbsp;</span></td>
                    <td nz-td class="center"> <span *ngIf="row.resolved_bugs"> <a href="javascript:;" (click)="showModalDialog('/wr/bug/list',{'dialogWidth':1000,'user':row.account, 'projectList':row.projectlist,  'beginDate':queryForm['beginDate'],  'endDate':queryForm['endDate'], 'status' :'resolved'})">{{row.resolved_bugs}}</a></span></td>
                    <td nz-td class="center"> <span *ngIf="row.completed_tasks"><a href="javascript:;" (click)="showModalDialog('/wr/task/list',{'user':row.account, 'beginDate':queryForm['beginDate'],  'endDate':queryForm['endDate'], 'status' :'closed'})">{{row.completed_tasks}}</a></span></td>
                    <td nz-td class="left"> <span>&nbsp;</span></td>
                </tr>
            </tbody>
        </nz-table>
    </ng-template>
</nz-card>